<%-
  ppn = num_cores.blank? ? 28 : num_cores.to_i
  nodes = bc_num_slots.blank? ? 1 : bc_num_slots.to_i
  partition = []

  if node_type == 'hugemem'
    ppn = 48
    partition_str = bc_num_slots.to_i > 1 ? "hugemem-parallel" : "hugemem"
    partition = [ "--partition", partition_str ]
  end

  slurm_args = partition + [ "--nodes", "#{nodes}", "--ntasks-per-node", "#{ppn}", "--licenses", "stata@osc" ]
%>
---
batch_connect:
  template: vnc
script:
  accounting_id: "<%= account %>"
  native:
  <%- slurm_args.each do |arg| %>
    - "<%= arg %>"
  <%- end %>
